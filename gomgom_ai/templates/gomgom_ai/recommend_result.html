{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¶”ì²œ ê²°ê³¼</title>

    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ac17c741aa8131e12604eac5e2d0441c&libraries=services&autoload=false"></script>


    <link rel="stylesheet" href="{% static 'css/randomfood.css' %}">
</head>
<body>

{% include 'gomgom_ai/loading.html' %}
<div class="background">
    <div class="header">
        <h3>
            <a href="{% url 'main' %}">
                <img id="logo" src="{% static 'image/logo.png' %}" alt="logo">

                <span class="header_text">&nbsp;CLICK YOUR TASTE!</span>
            </a>
        </h3>
    </div>
    <!-- ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ -->
    <div id="loading" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(255,255,255,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center;">
        <div class="spinner"></div>
    </div>

    <div class="card">
        <h3>ì˜¤ëŠ˜ì˜ ì¶”ì²œ ê°€ê²Œ</h3>
        <h3> {{ result.store }}</h3>
        <p><strong> {{ result.description }}</strong></p>

        <!-- í˜„ì¬ ì£¼ì†Œ ì¶œë ¥ -->
        <p id="current-address" style="font-weight: bold; font-size: 16px; color: #222;">
            ë¡œë”© ì¤‘...
        </p>
        <p><strong>ë‚´ê°€ ê²€ìƒ‰í•œ ë‹¨ì–´:</strong> {{ request.GET.text }}</p>
        <p>ğŸ“Œ <strong>ì¹´í…Œê³ ë¦¬: {{ restaurants.0.categories }}</strong></p>
        <p>ğŸ” <strong>ê´€ë ¨ í‚¤ì›Œë“œ: {{ result.keywords|join:", " }}</strong></p>
        <p>â­ <strong>í‰ì : {{ restaurants.0.review_avg }}</strong></p>
        <p>ğŸ  <strong>ì£¼ì†Œ: {{ restaurants.0.address }}</strong></p>
        <img src="{{ result.logo_url|default:'/static/image/default_store.png' }}" alt="ì¶”ì²œ ê°€ê²Œ ë¡œê³ " width="120">
        <!--    <p>ğŸ†” ê°€ê²Œ ID: {{ restaurants.0.id }}</p>-->
    </div>
    {% if DEBUG %}
    <div style="background-color:#f5f5f5; padding:10px; margin-top:20px;">
        <h3>ğŸ§ª ë””ë²„ê¹… ì •ë³´</h3>
        <p><strong>ì…ë ¥ í…ìŠ¤íŠ¸:</strong> {{ text }}</p>
        <p><strong>ìœ„ì¹˜:</strong> ìœ„ë„: {{ lat }}, ê²½ë„: {{ lng }}</p>
        <p><strong>ê¸°ë¶„ íƒœê·¸:</strong> {{ types }}</p>
        <p><strong>íƒœê·¸ ì ìˆ˜:</strong> {{ score }}</p>
        <p><strong>ì¶”ì²œ ê°€ê²Œ:</strong> {{ result.store }}</p>
        <p><strong>ì„¤ëª…:</strong> {{ result.description }}</p>
        <p><strong>ì¹´í…Œê³ ë¦¬:</strong> {{ result.category }}</p>
        <p><strong>í‚¤ì›Œë“œ:</strong> {{ result.keywords }}</p>
    </div>
    {% endif %}

</div>

</body>


<script>
    // í˜ì´ì§€ ë¡œë”© ì‹œ ì• ë‹ˆë©”ì´ì…˜ ë³´ì´ê¸°
    window.addEventListener('load', function () {
        document.getElementById('loading').style.display = 'none';
    });

    // í¼ ì „ì†¡ ì‹œ ì• ë‹ˆë©”ì´ì…˜ ë³´ì´ê¸° (í•„ìš” ì‹œ)
    function showLoading() {
        document.getElementById('loading').style.display = 'flex';
    }

    kakao.maps.load(function () {
        // Django í…œí”Œë¦¿ ê°’ì´ ìˆ«ìë¡œ ë“¤ì–´ì˜¤ë„ë¡ ê°•ì œ ë³€í™˜
        const lat = parseFloat("{{ lat|default:'37.484934' }}");
        const lng = parseFloat("{{ lng|default:'126.981321' }}");

        console.log("ìœ„ë„:", lat, "ê²½ë„:", lng);

        const geocoder = new kakao.maps.services.Geocoder();
        const coord = new kakao.maps.LatLng(lat, lng);

        geocoder.coord2Address(coord.getLng(), coord.getLat(), function (result, status) {
            if (status === kakao.maps.services.Status.OK) {
                const address = result[0].road_address
                    ? result[0].road_address.address_name
                    : result[0].address.address_name;

                console.log("ì£¼ì†Œ ë³€í™˜ ì„±ê³µ:", address);
                document.getElementById("current-address").innerText = "í˜„ì¬ ìœ„ì¹˜: " + address;
            } else {
                console.error("ì£¼ì†Œ ë³€í™˜ ì‹¤íŒ¨:", status);
                document.getElementById("current-address").innerText = `ìœ„ë„: ${lat}, ê²½ë„: ${lng}`;
            }
        });
    });
</script>
</html>
